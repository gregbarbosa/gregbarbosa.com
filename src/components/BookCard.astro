---
import { SITE_BASE } from '@/consts'
import type { ImageMetadata } from 'astro'
import { Image } from 'astro:assets'
import { CardContent } from '@/components/starwind/card'
import { AspectRatio } from '@/components/starwind/aspect-ratio'

const { review } = Astro.props

const bookCovers = import.meta.glob<{ default: ImageMetadata }>(
	'/src/assets/book-covers/**/*.{jpeg,jpg,png,gif,svg}'
)

const coverPath = review.data.cover
	? `/src/assets/book-covers/${review.data.cover}`
	: null
---

<div class="flex flex-col gap-4 pb-8 h-full group transition-colors">
	<a href={review.data.link} target="_blank" rel="noopener noreferrer">
		<AspectRatio ratio={2 / 3}>
			{
				coverPath && bookCovers[coverPath] && (
					<Image
						src={bookCovers[coverPath]()}
						alt={review.data.title}
						class="object-cover rounded-xl w-full h-full hover:shadow-lg transition-shadow"
						loading="eager"
					/>
				)
			}
			{
				!coverPath && (
					<div class="aspect-[2/3] w-full bg-gray-200 dark:bg-gray-800 rounded-xl flex items-center justify-center text-gray-400 hover:shadow-lg transition-shadow">
						No Cover
					</div>
				)
			}
		</AspectRatio>
	</a>
	<CardContent class="p-0">
		<a
			href={review.data.link}
			target="_blank"
			rel="noopener noreferrer"
			class="text-2xl font-semibold group-hover:text-primary dark:group-hover:text-primary-dark group-hover:underline transition-colors"
		>
			{review.data.title}
		</a>
		<p class="text-sm opacity-70">by {review.data.author}</p>
		<p class="opacity-80 mt-2">
			{review.data.description || 'No description available.'}
		</p>
		<div class="mt-4 flex justify-between items-center">
			{
				review.data.rating && (
					<span class="text-sm font-medium bg-primary/10 text-primary px-2 py-1 rounded">
						{review.data.rating}
					</span>
				)
			}
			{
				review.data.fullReview && (
					<a
						href={`${SITE_BASE}/reading-list/${review.slug}/`}
						class="text-sm font-medium text-primary hover:underline"
					>
						Read Full Review &rarr;
					</a>
				)
			}
		</div>
	</CardContent>
</div>
