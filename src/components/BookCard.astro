---
import { SITE_BASE } from '@/consts'
import type { ImageMetadata } from 'astro'
import { Image } from 'astro:assets'
import { Card, CardContent } from '@/components/starwind/card'
import { AspectRatio } from '@/components/starwind/aspect-ratio'

const { review } = Astro.props

const bookCovers = import.meta.glob<{ default: ImageMetadata }>(
	'/src/assets/book-covers/**/*.{jpeg,jpg,png,gif,svg}'
)

const coverPath = review.data.cover
	? `/src/assets/book-covers/${review.data.cover}`
	: null
---

<Card class="flex flex-col gap-4 h-full group hover:shadow-lg transition-all">
	<a href={review.data.link} target="_blank" rel="noopener noreferrer">
		<AspectRatio ratio={2 / 3}>
			{
				coverPath && bookCovers[coverPath] && (
					<Image
						src={bookCovers[coverPath]()}
						alt={review.data.title}
						class="object-cover rounded-xl w-full h-full hover:shadow-lg transition-shadow"
						loading="eager"
					/>
				)
			}
			{
				!coverPath && (
					<div class="aspect-2/3 w-full bg-gray-200 dark:bg-gray-800 rounded-xl flex items-center justify-center text-gray-400 hover:shadow-lg transition-shadow">
						No Cover
					</div>
				)
			}
		</AspectRatio>
	</a>
	<CardContent class="p-4 pt-0 flex flex-col gap-2 flex-1">
		<a
			href={review.data.link}
			target="_blank"
			rel="noopener noreferrer"
			class="text-xl font-semibold group-hover:text-primary dark:group-hover:text-primary-dark group-hover:underline transition-colors leading-tight"
		>
			{review.data.title}
		</a>
		<p class="text-sm opacity-70 -mt-1">by {review.data.author}</p>
		<p class="opacity-80 text-sm leading-relaxed">
			{review.data.description || 'No description available.'}
		</p>
		<div class="mt-auto flex justify-between items-center gap-2">
			{
				review.data.rating && (
					<span class="text-xs font-medium bg-primary/10 text-primary px-2 py-1 rounded">
						{review.data.rating}
					</span>
				)
			}
			{
				review.data.fullReview && (
					<a
						href={`${SITE_BASE}/reading-list/${review.id}/`}
						class="text-xs font-medium text-primary hover:underline"
					>
						Full Review &rarr;
					</a>
				)
			}
		</div>
	</CardContent>
</Card>
