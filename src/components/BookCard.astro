---
import { SITE_BASE } from '@/consts'
import type { ImageMetadata } from 'astro'
import { Image } from 'astro:assets'
import { Card, CardContent } from '@/components/starwind/card'
import { AspectRatio } from '@/components/starwind/aspect-ratio'
import { Icon } from 'astro-icon/components'

const { review } = Astro.props

const bookCovers = import.meta.glob<{ default: ImageMetadata }>(
	'/src/assets/book-covers/**/*.{jpeg,jpg,png,gif,svg}'
)

const coverPath = review.data.cover
	? `/src/assets/book-covers/${review.data.cover}`
	: null
---

<Card class="flex flex-col gap-4 h-full group hover:shadow-lg transition-all">
	<div>
		<AspectRatio ratio={2 / 3}>
			{
				coverPath && bookCovers[coverPath] && (
					<Image
						src={bookCovers[coverPath]()}
						alt={review.data.title}
						class="object-cover w-full h-full hover:shadow-lg transition-shadow"
						loading="eager"
					/>
				)
			}
			{
				!coverPath && (
					<div class="aspect-2/3 w-full bg-gray-200 dark:bg-gray-800 flex items-center justify-center text-gray-400 hover:shadow-lg transition-shadow">
						No Cover
					</div>
				)
			}
		</AspectRatio>
	</div>
	<CardContent class="p-4 pt-0 flex flex-col gap-2 flex-1">
		<p
			class="text-xl font-semibold group-hover:text-primary dark:group-hover:text-primary-dark group-hover:underline transition-colors leading-tight"
		>
			{review.data.title}
		</p>
		<p class="text-sm opacity-70 -mt-1">by {review.data.author}</p>
		<p class="opacity-80 text-sm leading-relaxed">
			{review.data.description || 'No description available.'}
		</p>
		<div class="mt-auto flex justify-between items-center gap-2">
			<div>
				{
					review.data.rating && (
						<span class="text-xs font-medium bg-primary/10 text-primary px-2 py-1 rounded">
							{review.data.rating}
						</span>
					)
				}
			</div>
			<div class="flex items-center gap-2">
				{
					review.data.link_amazon && (
						<a
							href={review.data.link_amazon}
							target="_blank"
							rel="noopener noreferrer"
							aria-label={`Buy ${review.data.title} on Amazon`}
							class="text-primary hover:text-primary/80 dark:text-primary-dark dark:hover:text-primary-dark/80 transition-colors"
						>
							<Icon name="mdi:amazon" class="w-5 h-5" />
						</a>
					)
				}
				{
					review.data.link_bookshop && (
						<a
							href={review.data.link_bookshop}
							target="_blank"
							rel="noopener noreferrer"
							aria-label={`Buy ${review.data.title} on Bookshop.org`}
							class="text-primary hover:text-primary/80 dark:text-primary-dark dark:hover:text-primary-dark/80 transition-colors"
							title="Bookshop.org"
						>
							<svg
								class="w-4 h-4 fill-current"
								viewBox="0 0 1000 1000"
								xmlns="http://www.w3.org/2000/svg"
								aria-hidden="true"
							>
								<path
									fill-rule="evenodd"
									clip-rule="evenodd"
									d="M909.044 670.436C896.927 685.845 881.505 699.052 864.981 708.957C860.024 711.709 854.516 714.46 849.559 716.662C810.453 731.52 768.593 732.07 726.733 732.07H481.633H438.672H180.352C167.133 732.07 156.118 721.064 156.118 707.857V688.046V638.519V574.683V511.398V463.522C156.118 453.616 154.465 442.61 159.973 433.805C164.379 426.651 172.09 421.699 180.352 421.699H697.541C730.038 421.699 762.534 421.148 795.031 423.9C828.078 427.202 859.473 439.308 885.911 458.569C894.723 465.723 902.985 473.427 909.595 482.232C931.626 508.096 945.947 541.115 946.497 575.234C945.947 611.003 931.626 644.022 909.044 670.436ZM156.118 284.673V219.737V152.6V100.321V80.5101C156.118 67.3028 167.133 56.2967 180.352 56.2967H758.679C799.437 55.1961 839.645 65.6518 874.895 86.5634C907.392 108.025 931.075 140.493 942.642 177.364C945.947 188.92 948.701 201.027 948.15 213.684C947.599 247.252 933.279 279.17 910.696 304.484C898.579 319.892 883.157 332.549 866.082 342.455C827.527 360.615 785.667 365.017 743.257 365.017H727.284H180.352C165.481 365.017 156.118 351.81 156.118 338.052C155.567 320.443 156.118 302.833 156.118 284.673ZM998.271 548.819C996.068 533.41 992.213 518.552 986.154 504.244C980.646 489.936 973.486 476.179 965.224 463.522C956.412 450.865 945.947 439.308 934.931 428.853C928.321 422.799 921.161 417.296 914.001 411.793L901.884 402.988C898.028 399.686 893.622 397.485 889.766 394.183C904.087 384.828 918.407 374.923 931.626 363.917C943.193 354.011 953.107 343.005 961.919 330.348C970.732 318.241 977.892 305.034 983.951 290.726C988.908 279.17 992.764 267.613 995.517 255.507C999.924 231.293 1000.47 205.429 996.619 181.216C994.967 170.76 992.763 160.304 989.459 150.399C982.849 130.037 972.935 110.777 960.267 93.7174C954.759 86.5634 949.251 79.9598 943.193 73.3561C927.22 56.847 909.044 42.5391 889.215 32.0833C875.997 23.8287 862.227 17.7754 847.906 12.8226C811.004 3.46747 772.999 -0.934963 734.995 0.165646C734.995 0.165646 67.4408 0.165646 10.7098 0.165646C5.20188 0.165646 0.795578 4.56808 0.795578 10.0711V45.2906C0.795578 55.1961 10.7098 55.7464 18.4208 55.7464H52.0188C52.0188 55.7464 72.9487 55.7464 80.1089 55.7464C93.3278 55.7464 104.344 66.2021 104.344 79.9598C104.344 83.8119 104.344 92.0664 104.344 95.9186C104.344 100.321 104.344 104.723 104.344 109.126C104.344 166.908 104.344 340.804 104.344 340.804C104.344 347.408 101.59 354.011 96.6326 358.414C94.4294 360.615 91.1247 362.266 88.3708 363.366C84.5152 365.017 80.6597 365.017 76.8042 365.017C56.9759 365.017 37.6983 365.568 17.87 365.568C14.5653 365.568 10.7098 365.568 7.95581 366.118C5.20188 367.219 2.99873 368.869 1.34637 371.621C0.244793 374.373 0.244794 377.124 0.244794 379.876C0.244794 384.828 0.244794 389.231 0.244794 394.183C0.244794 399.136 -0.305993 404.639 0.244794 409.592C0.244794 411.793 0.795583 413.994 1.89716 416.196C3.54952 420.048 7.95581 421.148 11.8113 421.148H37.6983H75.1519C82.8629 421.148 90.5739 422.249 96.6326 427.752C103.793 434.356 104.344 443.161 104.344 451.965C104.344 460.22 104.344 468.475 104.344 477.279C104.344 489.936 104.344 502.593 104.344 514.7V526.256V581.837V614.305V674.839V706.756C104.344 719.963 93.3278 730.97 80.1089 730.97H37.6983C32.7412 730.97 22.8271 730.97 17.87 730.97C15.1161 730.97 12.3621 730.97 10.7098 730.97C7.40503 730.97 5.75266 731.52 3.54952 733.171C1.89715 734.271 0.795578 736.473 0.795578 738.674C0.795578 739.774 0.795578 741.976 0.795578 743.076V776.645C0.795578 778.846 1.34637 781.047 2.99873 782.698C6.30345 785.45 9.60818 786 14.0145 786H269.58H571.962C634.201 786 695.338 785.45 757.577 786C775.753 786 795.582 785.45 813.758 782.698C825.875 781.047 837.992 778.296 849.559 774.444C863.879 769.491 877.649 763.437 890.317 755.733C910.145 744.727 928.321 730.419 944.294 713.36C974.037 680.892 994.416 640.72 998.822 596.695C1000.47 581.837 1000.47 565.328 998.271 548.819Z"
								/>
							</svg>
						</a>
					)
				}
				{
					review.data.fullReview && (
						<a
							href={`${SITE_BASE}/reading-list/${review.slug}/`}
							class="text-xs font-medium text-primary hover:underline"
						>
							Full Review &rarr;
						</a>
					)
				}
			</div>
		</div>
	</CardContent>
</Card>
