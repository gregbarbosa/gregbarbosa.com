---
import NavbarLink from './NavbarLink.astro'
import { Icon } from 'astro-icon/components'
import ThemeSelector from './ThemeSelector.astro'
import { SITE_BASE, WebsiteLinks } from '../consts'
import { Button } from '@/components/starwind/button'
import { SocialLinks } from '../consts'
import {
	Sheet,
	SheetTrigger,
	SheetContent,
	SheetHeader,
	SheetTitle,
	SheetClose,
	SheetDescription,
	SheetFooter,
} from '@/components/starwind/sheet'
---

<header class="fixed top-0 w-full z-40 bg-background dark:bg-background">
	<nav class="">
		<div
			class="app-container md:border-2 md:rounded-full flex justify-between items-center py-1 mt-2 not-md:border-b not-md:border-b-[#2d4d42]"
		>
			<a
				href={`${SITE_BASE}/`}
				aria-label="Home"
				aria-current={Astro.url.pathname === `${SITE_BASE}/`
					? 'page'
					: undefined}
			>
				<!-- <LogoSVG height={36} width={36} /> -->
				<h2 class="text-2xl font-bold">GREG BARBOSA</h2>
			</a>
			<div class="gap-8 hidden md:flex items-center">
				{
					WebsiteLinks.map((link) => (
						<NavbarLink
							class="text-md"
							href={`${link.url}`}
							target={link.url.charAt(0) === 'h' ? '_blank' : '_self'}
						>
							{link.name}
						</NavbarLink>
					))
				}
				<Button variant="primary" size="sm" href="#footer">Subscribe</Button>
				<ThemeSelector />
			</div>
			<Sheet class="md:hidden">
				<SheetTrigger asChild>
					<button
						aria-label="Open navigation menu"
						class="md:hidden cursor-pointer p-3 rounded-md hover:bg-muted transition-colors"
						title="Open navigation menu"
					>
						<Icon aria-hidden name="mdi:menu" size={32} />
					</button>
				</SheetTrigger>
				<SheetContent>
					<SheetHeader>
						<!-- <SheetTitle>Menu</SheetTitle>
						<Separator class="mt=2" /> -->
					</SheetHeader>
					<div class="flex flex-col px-4 gap-5">
						{
							WebsiteLinks.map((link) => (
								<NavbarLink class="text-3xl" href={link.url}>
									{link.name}
								</NavbarLink>
							))
						}
					</div>
					<div class="mt-4 w-full flex justify-center"></div>
					<SheetFooter>
						<div class="flex flex-wrap justify-between gap-4 mt-4">
							{
								SocialLinks.map((link) => (
									<a
										class="text-lg"
										href={link.url}
										target="_blank"
										rel="noopener noreferrer"
										aria-label={link.name}
									>
										<Icon class="text-3xl" name={`mdi:${link.icon}`} />
									</a>
								))
							}
							<ThemeSelector />
						</div>
						<Button variant="primary">Subscribe</Button>
					</SheetFooter>
				</SheetContent>
			</Sheet>
		</div>
	</nav>

	<script is:inline>
		function reComputeTheme() {
			if (
				localStorage.theme === 'dark' ||
				(!('theme' in localStorage) &&
					window.matchMedia('(prefers-color-scheme: dark)').matches)
			) {
				document.documentElement.classList.add('dark')
			} else {
				document.documentElement.classList.remove('dark')
			}

			const theme = localStorage.theme || 'auto'
			document
				.querySelectorAll('.theme-button')
				.forEach((el) => el.classList.remove('active'))
			document
				.querySelectorAll(`[data-theme="theme-${theme}"]`)
				.forEach((el) => el.classList.add('active'))
		}

		function addThemeEventListeners() {
			themeButtons = document.querySelectorAll('.theme-button')
			themeButtons.forEach((button) => {
				button.addEventListener('click', () => {
					themeButtons.forEach((btn) => btn.classList.remove('active'))
					button.classList.add('active')
					if (button.dataset.theme === 'theme-auto') {
						localStorage.removeItem('theme')
						reComputeTheme()
					} else {
						localStorage.theme = button.dataset.theme.replace('theme-', '')
						document.documentElement.classList.toggle(
							'dark',
							button.dataset.theme === 'theme-dark'
						)
					}
				})
			})
		}

		// Set active class on OS theme change
		window
			.matchMedia('(prefers-color-scheme: dark)')
			.addEventListener('change', (_e) => {
				reComputeTheme()
			})

		// Run on page load
		window.addEventListener('DOMContentLoaded', () => {
			addThemeEventListeners()
			reComputeTheme()
		})
	</script>
</header>
