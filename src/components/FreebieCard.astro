---
import { SITE_BASE } from '@/consts'
import FormattedDate from './FormattedDate.astro'
import type { ImageMetadata } from 'astro'
import { Image } from 'astro:assets'
import noThumbnail from '../assets/no-thumbnail.jpg'
import { Card, CardContent } from '@/components/starwind/card'
import { AspectRatio } from '@/components/starwind/aspect-ratio'

const { freebie } = Astro.props

const freebieImages = import.meta.glob<{ default: ImageMetadata }>(
	'/src/assets/freebies/**/*.{jpeg,jpg,png,gif,webp}'
)

const coverImageKey = Object.keys(freebieImages).find((path) =>
	path.includes(`/freebies/${freebie.id}/cover.`)
)
---

<a
	href={`${SITE_BASE}/freebies/${freebie.id}/`}
	class="block h-full transition-colors group"
>
	<Card class="h-full flex flex-col">
		<AspectRatio ratio={16 / 9}>
			{
				coverImageKey && freebieImages[coverImageKey] ? (
					<Image
						src={freebieImages[coverImageKey]()}
						alt={freebie.data.title}
						class="object-cover rounded-t-lg w-full h-full"
						loading="eager"
					/>
				) : (
					<Image
						src={noThumbnail}
						alt={freebie.data.title}
						class="object-cover rounded-t-lg w-full h-full"
						loading="eager"
					/>
				)
			}
		</AspectRatio>
		<CardContent class="p-4 flex flex-col gap-3 flex-1 pt-4">
			<h2
				class="text-2xl font-semibold group-hover:text-primary dark:group-hover:text-primary-dark group-hover:underline transition-colors"
			>
				{freebie.data.title}
			</h2>
			<p class="opacity-80 line-clamp-2">
				{freebie.data.description}
			</p>
			<p class="uppercase text-sm mt-auto tracking-tight opacity-70">
				<FormattedDate date={freebie.data.pubDate} />
			</p>
		</CardContent>
	</Card>
</a>
