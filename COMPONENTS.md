# Component Development Guide

This guide covers patterns for creating, composing, and maintaining components in Saral. All components should follow these conventions for consistency and long-term maintainability.

## Component Types

Saral has two distinct component categories:

### 1. Custom Components (Domain-Specific)
Located in `src/components/` (excluding `starwind/`). These are built for Saral's specific needs.

**Examples:** `BlogCard.astro`, `ProjectCard.astro`, `PageLayout.astro`, `Navbar.astro`

**Characteristics:**
- Handle domain logic (blog posts, projects, reading list items)
- Use Starwind components as building blocks
- Appear on multiple pages or have significant complexity
- Strongly typed with Props interfaces

### 2. Starwind Components (Generic UI)
Located in `src/components/starwind/`. These are auto-generated by the Starwind CLI and should be treated as read-only.

**Examples:** `Button`, `Card`, `Dialog`, `Input`, `Toggle`

**Characteristics:**
- Generic, reusable UI elements
- Rarely need modification
- Support multiple variants via `tailwind-variants`
- Installed via `npx starwind@latest add <component>`

---

## Props Definition Patterns

### Pattern 1: Simple Props with Interface (Most Common)

Use when your component has simple, custom props:

```astro
---
interface Props {
  title: string
  description?: string
  count: number
}

const { title, description, count } = Astro.props
---

<div>
  <h2>{title}</h2>
  {description && <p>{description}</p>}
  <span>{count}</span>
</div>
```

**When to use:**
- Custom domain components
- Simple prop lists (no HTML attributes needed)
- Props don't overlap with HTML attributes

---

### Pattern 2: Extending HTML Attributes (Preferred for Styled Components)

Use when your component wraps an HTML element and accepts HTML attributes:

```astro
---
import type { HTMLAttributes } from 'astro/types'

interface Props extends HTMLAttributes<'div'> {
  variant?: 'primary' | 'secondary'
  size?: 'sm' | 'md' | 'lg'
}

const { variant = 'primary', size = 'md', class: className, ...rest } = Astro.props
---

<div class:list={[baseStyles, variantStyles[variant], sizeStyles[size], className]} {...rest}>
  <slot />
</div>
```

**When to use:**
- Custom styled containers
- Components that should accept `class`, `id`, event handlers
- Components that forward HTML attributes to elements
- Best practice for maximum flexibility

**Key details:**
- Extract `class` as `className` to merge with component styles
- Use spread `{...rest}` to forward remaining attributes
- Always place custom props before HTML attributes

---

### Pattern 3: Polymorphic Components (Advanced)

Use for components that can render as different HTML elements:

```astro
---
import type { HTMLAttributes } from 'astro/types'

type ValidTag = 'h1' | 'h2' | 'h3' | 'div' | 'section'

interface Props extends HTMLAttributes<'div'> {
  as?: ValidTag
  level?: 1 | 2 | 3
}

const { as: Tag = 'div', level, class: className, ...rest } = Astro.props
const headingClass = level === 1 ? 'text-4xl' : level === 2 ? 'text-3xl' : 'text-2xl'
---

<Tag class:list={[headingClass, className]} {...rest}>
  <slot />
</Tag>
```

**When to use:**
- Heading components (h1, h2, h3)
- Layout containers with semantic flexibility
- See Starwind's AspectRatio component for real example

---

### Pattern 4: Using Variants with tailwind-variants

Use for components with multiple visual variants:

```astro
---
import type { HTMLAttributes } from 'astro/types'
import { tv, type VariantProps } from 'tailwind-variants'

const buttonStyles = tv({
  base: 'inline-flex items-center justify-center rounded-md font-medium transition-all focus-visible:ring-3',
  variants: {
    variant: {
      primary: 'bg-primary text-primary-foreground hover:bg-primary/90',
      outline: 'border border-input bg-background hover:bg-muted',
      ghost: 'hover:bg-muted hover:text-foreground',
    },
    size: {
      sm: 'h-9 px-3 text-sm',
      md: 'h-11 px-4 text-base',
      lg: 'h-12 px-8 text-lg',
    },
  },
  defaultVariants: { variant: 'primary', size: 'md' },
})

interface Props extends HTMLAttributes<'button'>, VariantProps<typeof buttonStyles> {}

const { variant, size, class: className, ...rest } = Astro.props
---

<button class:list={buttonStyles({ variant, size, class: className })} {...rest}>
  <slot />
</button>
```

**When to use:**
- Components with multiple visual states (variants)
- Avoid explosion of conditional classes
- Provides type-safe variant selection
- See `src/components/starwind/button/Button.astro` for full example

**Key details:**
- Export the `tv()` style constant (don't inline)
- Extend Props with `VariantProps<typeof yourStyles>`
- Combine variants with `yourStyles({ variant, size, class: className })`

---

## Slot Conventions

### Unnamed Slots (Default)

Use for simple content insertion:

```astro
---
// Card.astro
interface Props {
  title: string
}
---

<div class="rounded-lg border p-4">
  <h3>{title}</h3>
  <slot />  <!-- Default content goes here -->
</div>
```

**Usage:**
```astro
<Card title="My Card">
  <p>This content fills the default slot</p>
</Card>
```

**When to use:**
- Single main content area
- Simple components (Card, Container, etc.)
- Props are sufficient for structure

---

### Named Slots (For Complex Components)

Use when a component has multiple content areas:

```astro
---
// PageLayout.astro
interface Props {
  title?: string
  description?: string
}
---

{(title || description) && (
  <main id="main-content" class="app-container pt-36">
    {title && <h1>{title}</h1>}
    {description && <p>{description}</p>}
  </main>
)}

<section class="app-container py-12">
  <slot />  <!-- Main content area -->
</section>
```

**Usage:**
```astro
<PageLayout title="Blog" description="My thoughts">
  <div class="max-w-2xl mb-12">
    <!-- Content in default slot -->
  </div>
</PageLayout>
```

**When to use:**
- Components with multiple content regions (header, body, footer)
- Complex layouts with optional sections
- See PageLayout, Dialog, Sheet components

---

## Component Composition Strategies

### Strategy 1: Composition Over Extension

Good: Compose multiple Starwind components

```astro
---
import { Card, CardContent, CardHeader, CardTitle } from '@/components/starwind/card'
import { Badge } from '@/components/starwind/badge'

interface Props {
  post: BlogPost
}
---

<Card>
  <CardHeader>
    <CardTitle>{post.title}</CardTitle>
  </CardHeader>
  <CardContent>
    <p>{post.description}</p>
    <Badge>{post.category}</Badge>
  </CardContent>
</Card>
```

Bad: Modifying Starwind components directly

```astro
<!-- DON'T DO THIS -->
<Button class="my-custom-button">{label}</Button>
<!-- Starwind components are read-only -->
```

**Key principle:** Starwind components should not be edited. If you need different behavior, create a wrapper component.

---

### Strategy 2: Container vs. Presentational

**Containers** manage data and state:
```astro
---
import { getCollection } from 'astro:content'
import BlogCardList from './BlogCardList.astro'

const posts = await getCollection('blog')
---

<BlogCardList posts={posts} />
```

**Presentational** components render UI:
```astro
---
interface Props {
  posts: BlogPost[]
}

const { posts } = Astro.props
---

<ul class="grid gap-6">
  {posts.map((post) => (
    <li><BlogCard post={post} /></li>
  ))}
</ul>
```

**Pattern:**
- Pages are containers (fetch data)
- Custom components are usually presentational
- Avoid data fetching in presentational components

---

## Accessibility Checklist

Every interactive component must have:

- [ ] **Keyboard navigation** - All functionality works via keyboard (Tab, Enter, Arrow keys)
- [ ] **Focus management** - Clear focus indicators visible (`focus-visible:ring-3`)
- [ ] **ARIA attributes** - `role`, `aria-label`, `aria-expanded`, `aria-pressed`, etc.
- [ ] **Semantic HTML** - Use `<button>`, `<a>`, `<form>` instead of `<div>` where appropriate
- [ ] **Screen reader support** - Icons use `aria-hidden`, links have labels
- [ ] **Color contrast** - Text has sufficient contrast (WCAG AA minimum)

### Example: Accessible Button

```astro
---
import type { HTMLAttributes } from 'astro/types'
import { tv } from 'tailwind-variants'

interface Props extends HTMLAttributes<'button'> {
  variant?: 'primary' | 'outline'
  disabled?: boolean
}

const { variant = 'primary', disabled, class: className, ...rest } = Astro.props
---

<button
  class:list={[
    'inline-flex items-center justify-center rounded-md',
    'focus-visible:ring-3 focus-visible:outline-none', <!-- Focus indicator -->
    'disabled:opacity-50 disabled:pointer-events-none',
    variant === 'primary' && 'bg-primary text-white hover:bg-primary/90',
    variant === 'outline' && 'border border-current hover:bg-muted',
    className,
  ]}
  disabled={disabled}
  aria-pressed={rest['aria-pressed']} <!-- Forwarded ARIA -->
  {...rest}
>
  <slot />
</button>
```

### ARIA Attributes Reference

| Attribute | Use Case | Example |
|-----------|----------|---------|
| `aria-label` | Describe icon buttons, links without text | `<button aria-label="Close menu">Ã—</button>` |
| `aria-pressed` | Toggle buttons | `<button aria-pressed="true">` |
| `aria-expanded` | Collapsible content | `<button aria-expanded="false" aria-controls="menu">` |
| `aria-hidden` | Decorative icons | `<Icon aria-hidden name="chevron" />` |
| `aria-describedby` | Tooltips, help text | `<button aria-describedby="help-text">` |
| `role` | Semantic meaning | `role="menu"`, `role="menuitem"`, `role="separator"` |

---

## Common Component Patterns

### Pattern: Card Component

```astro
---
import type { HTMLAttributes } from 'astro/types'

interface Props extends HTMLAttributes<'div'> {}

const { class: className, ...rest } = Astro.props
---

<div
  class:list={[
    'rounded-lg border border-border bg-card p-6',
    'shadow-sm hover:shadow-md transition-shadow',
    className,
  ]}
  {...rest}
>
  <slot />
</div>
```

**Key features:**
- Extends HTMLAttributes for maximum flexibility
- Forwarding spread operator
- Consistent border, padding, shadow

---

### Pattern: Link-Like Component

```astro
---
import type { HTMLAttributes } from 'astro/types'

interface Props extends Omit<HTMLAttributes<'a'>, 'href'> {
  href: string
  external?: boolean
}

const { href, external = false, class: className, ...rest } = Astro.props
---

<a
  href={href}
  target={external ? '_blank' : undefined}
  rel={external ? 'noopener noreferrer' : undefined}
  class:list={[
    'text-primary hover:underline focus-visible:outline-none focus-visible:ring-2',
    className,
  ]}
  {...rest}
>
  <slot />
</a>
```

---

### Pattern: Icon Button

```astro
---
import type { HTMLAttributes } from 'astro/types'
import { Icon } from 'astro-icon/components'

interface Props extends HTMLAttributes<'button'> {
  icon: string
  label: string
}

const { icon, label, class: className, ...rest } = Astro.props
---

<button
  aria-label={label}
  class:list={[
    'inline-flex items-center justify-center size-10 rounded-md',
    'focus-visible:ring-2 hover:bg-muted transition-colors',
    className,
  ]}
  {...rest}
>
  <Icon aria-hidden name={icon} />
</button>
```

---

## When to Create a New Component

Create a new component if:

1. **Reusable across pages** - Used in 2+ different places
2. **Complex logic** - Significant conditional rendering or data transformation
3. **Self-contained** - Can be tested/modified independently
4. **Domain-specific** - Represents a concept in your content model

Don't create a component if:

1. **One-time use** - Appears in a single page
2. **Simple markup** - Just a few lines of HTML + Tailwind
3. **High volatility** - Frequent design changes suggest it's still evolving

---

## Component Documentation

Add JSDoc comments for public components:

```astro
---
/**
 * BlogCard
 *
 * Displays a blog post as a clickable card with cover image, title, and date.
 * Links to the full post.
 *
 * @component
 * @example
 *   <BlogCard post={blogEntry} />
 */

interface Props {
  /** The blog post collection entry */
  post: CollectionEntry<'blog'>
}
---
```

---

## Import Organization

Standard import order:

1. Astro imports
2. Type imports
3. Component imports (alphabetical)
4. Data imports

```astro
---
import type { CollectionEntry } from 'astro:content'
import { Image } from 'astro:assets'

import { Card } from '@/components/starwind/card'
import { Badge } from '@/components/starwind/badge'
import FormattedDate from './FormattedDate.astro'

import { SITE_BASE } from '@/consts'
---
```

---

## Next Steps

After reading this guide:

1. Review the examples in `src/components/`
2. Check STYLING.md for component styling patterns
3. See PATTERNS.md for page-level composition
4. Run `npm run lint` to catch any pattern violations
